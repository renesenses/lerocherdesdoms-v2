---
import { url, asset } from '../utils/paths'

interface Slide {
  image: string
  title: string
  subtitle?: string
  ctaLabel?: string
  ctaHref?: string
}

interface Props {
  slides: Slide[]
}

const { slides } = Astro.props
---

<section class="relative h-[70vh] min-h-[400px] overflow-hidden" data-carousel>
  {slides.map((slide, i) => (
    <div
      class:list={[
        'carousel-slide absolute inset-0 transition-opacity duration-700',
        i === 0 ? 'opacity-100 z-10' : 'opacity-0 z-0',
      ]}
      data-slide={i}
    >
      <img src={asset(slide.image)} alt="" class="w-full h-full object-cover" loading={i === 0 ? 'eager' : 'lazy'} />
      <div class="absolute inset-0 bg-black/40"></div>
      <div class="absolute inset-0 flex items-center justify-center z-10">
        <div class="text-center px-4 max-w-3xl mx-auto">
          <h2 class="font-heading text-4xl md:text-5xl lg:text-6xl text-white mb-4 drop-shadow-lg">
            {slide.title}
          </h2>
          {slide.subtitle && (
            <p class="text-lg md:text-xl text-white/90 mb-8 max-w-2xl mx-auto">
              {slide.subtitle}
            </p>
          )}
          {slide.ctaLabel && slide.ctaHref && (
            <a
              href={url(slide.ctaHref)}
              class="inline-block bg-accent hover:bg-accent-dark text-white font-heading uppercase tracking-widest text-sm px-8 py-4 transition-colors"
            >
              {slide.ctaLabel}
            </a>
          )}
        </div>
      </div>
    </div>
  ))}

  {slides.length > 1 && (
    <div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-20 flex gap-3">
      {slides.map((_, i) => (
        <button
          class:list={[
            'carousel-dot w-3 h-3 rounded-full border-2 border-white/70 transition-colors',
            i === 0 ? 'bg-white' : 'bg-transparent',
          ]}
          data-dot={i}
          aria-label={`Slide ${i + 1}`}
        />
      ))}
    </div>
  )}
</section>

<script is:inline>
  (function() {
    var carousel = document.querySelector('[data-carousel]');
    if (!carousel) return;

    var slides = carousel.querySelectorAll('[data-slide]');
    var dots = carousel.querySelectorAll('[data-dot]');
    if (slides.length <= 1) return;

    var current = 0;
    var timer;

    function goTo(index) {
      slides[current].classList.remove('opacity-100', 'z-10');
      slides[current].classList.add('opacity-0', 'z-0');
      if (dots[current]) {
        dots[current].classList.remove('bg-white');
        dots[current].classList.add('bg-transparent');
      }

      current = index;
      slides[current].classList.remove('opacity-0', 'z-0');
      slides[current].classList.add('opacity-100', 'z-10');
      if (dots[current]) {
        dots[current].classList.remove('bg-transparent');
        dots[current].classList.add('bg-white');
      }
    }

    function next() {
      goTo((current + 1) % slides.length);
    }

    function startTimer() {
      timer = setInterval(next, 6000);
    }

    for (var i = 0; i < dots.length; i++) {
      (function(idx) {
        dots[idx].addEventListener('click', function() {
          clearInterval(timer);
          goTo(idx);
          startTimer();
        });
      })(i);
    }

    startTimer();
  })();
</script>
